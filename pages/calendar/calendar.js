// pages/calendar.js
Page({

  /**
   * 页面的初始数据
   */
  // 测试用数据,后期需后端更新
  data: {
    history: [{"model":"minip.tmdbmovie","pk":310,"fields":{"overview":"1984年的东德，整个社会笼罩在国家安全局的高压统治之下，特工魏斯曼（乌尔利希·穆厄 饰）奉命监听剧作家德莱曼（塞巴斯蒂安·寇治 饰）和他妻子演员克里斯蒂娜（玛蒂娜·杰蒂克 饰）的生活，监听过程中，魏斯曼渐渐对这家人的生活产生了兴趣，开始暗中帮助他们。一篇刊登在西德《明镜》报上的文章引起了特工头目的注意，他们认为这篇文章是德莱曼写的，并逮捕了克里斯蒂娜，希望能够从她口中得出她丈夫的秘密？而审问克里斯蒂娜的正是魏斯曼。","tmdb_id":"582","title":"窃听风暴","original_title":"Das Leben der Anderen","publish_date":"2006-03-23","budget":2000000,"runtime":137,"revenue":70000000,"backdrop_path":"https://image.tmdb.org/t/p/w500/3mxteiwtcCPjbYKlyC0WxY1G9J3.jpg","poster_path":"https://image.tmdb.org/t/p/w500/8q0vsuL9iHoOe6JGUHwzLEQIugG.jpg","count":3644,"value":"8.000","actors":["玛蒂娜·戈黛特","乌尔里希·穆埃","塞巴斯蒂安·科赫","乌尔里希·图库尔","托马斯·席尔梅"],"directors":["弗洛里安·亨克尔·冯·多纳斯马尔克"]}},{"model":"minip.tmdbmovie","pk":521,"fields":{"overview":"年轻女子（琼·芳登 Joan Fontaine 饰）初遇曼德利主人德文特（劳伦斯·奥利弗 Laurence Olivier 饰）是在海边的悬崖边上。她以为德文特要跳海自尽，大叫一声，让德文特生气不已。然而，接下来的二人相识继而相知的经历让他们堕入爱河，结为伉俪，女子成为了曼德利庄园的女主人。  　　幸福的生活眼看就要铺开，这个新婚妻子却遭遇到了阴森的“寒流”。她发现这个庄园到处可见德文特前妻丽贝卡的影子，她的名字，在家具留下痕迹，更令新婚妻子不安的是，管家丹佛斯太太，更是念念不忘丽贝卡，对这个新来的主人充满仇恨。就连丈夫德文特，也不愿意解释这一切，仿佛他的内心还有旧情。  　　丽贝卡犹如梦魇般弥漫在曼德利庄园，事情开始变得越来越复杂。","tmdb_id":"223","title":"蝴蝶梦","original_title":"Rebecca","publish_date":"1940-03-23","budget":1288000,"runtime":130,"revenue":7592465,"backdrop_path":"https://image.tmdb.org/t/p/w500/jKgLVAhoq4fXBs1C9Gjvap93fxd.jpg","poster_path":"https://image.tmdb.org/t/p/w500/1qz3qUOHnVy7dL7M7G8jSErxE4b.jpg","count":1744,"value":"7.900","actors":["劳伦斯·奥利弗","琼·芳登","乔治·桑德斯","朱迪思·安德森","奈杰尔·布鲁斯"],"directors":["阿尔弗雷德·希区柯克"]}},{"model":"minip.tmdbmovie","pk":593,"fields":{"overview":"开创性纪录片《奶牛阴谋》的联合创剧人带来《海洋阴谋》，这部后续纪录片揭示了令人担忧的事实：人类行为已对海洋环境造成广泛的破坏，但这点却鲜为人知。电影制作人阿里·塔瑞兹原本只打算拍摄他心爱的海洋，但后来却发现自己在审视人类对脆弱的海洋所造成的伤害。从污染水域的塑料和渔具，到底拖作业和副渔获造成的不可挽回的破坏，再到非法捕鱼和毁灭性的狩猎行为，人类正在对海洋生物造成重创，进而威胁到整个地球。塔瑞兹的最终发现不仅挑战了可持续捕鱼的理念，任何人如果关注海洋生命、地球的未来以及人类和地球的关系，都将从中得到警示。","tmdb_id":"801058","title":"海洋阴谋","original_title":"Seaspiracy","publish_date":"2021-03-23","budget":0,"runtime":89,"revenue":0,"backdrop_path":"https://image.tmdb.org/t/p/w500/AcvxSLa140z7qgGQ8G2UjhcgVEY.jpg","poster_path":"https://image.tmdb.org/t/p/w500/iFNri0fwn1WfCoxf3H3v1z8dCm4.jpg","count":406,"value":"7.856","actors":["Ali Tabrizi","Sylvia Earle","Richard O'Barry","Paul de Gelder","Lucy Tabrizi"],"directors":["Ali Tabrizi"]}},{"model":"minip.tmdbmovie","pk":599,"fields":{"overview":"　　韦斯·安德森的新片又定为一部关于狗的定格动画。杰夫·高布伦近日和乐队做爵士演出时，透露他参与该片配音。同片还有爱德华·诺顿+鲍勃·巴拉班+布莱恩·科兰斯顿，老白首次合作安德森，另3位和导演是熟人。高布伦说新片灵感来自日本，四位的角色都是狗。","tmdb_id":"399174","title":"犬之岛","original_title":"Isle of Dogs","publish_date":"2018-03-23","budget":62770198,"runtime":101,"revenue":64337744,"backdrop_path":"https://image.tmdb.org/t/p/w500/jB5zHG1eHh0OC1S61itXNApZlLD.jpg","poster_path":"https://image.tmdb.org/t/p/w500/6o7cIPUwasrxJyt4ods79EbLRfd.jpg","count":4858,"value":"7.853","actors":["布莱恩·科兰斯顿","Koyu Rankin","鲍勃·巴拉班","爱德华·诺顿","比尔·莫瑞"],"directors":["韦斯·安德森"]}},{"model":"minip.tmdbmovie","pk":1005,"fields":{"overview":"科特·柯本的纪录片《Kurt Cobain: Montage of Heck》将于明年在HBO播出，该片由Brett Morgen执导，并获得柯本女儿Frances Bean Cobain的支持，提供大量未公开的家庭录像、录音、图片、demos以及歌集等等。收集的未发行音乐和录音就超过200小时。该片已制作了八年，将带给观众一个更不为人知的柯本。","tmdb_id":"319075","title":"科特·柯本：烦恼的蒙太奇","original_title":"Cobain: Montage of Heck","publish_date":"2015-03-23","budget":0,"runtime":132,"revenue":0,"backdrop_path":"https://image.tmdb.org/t/p/w500/30UGnraRdbZl4a8vcfYJPIzvzjM.jpg","poster_path":"https://image.tmdb.org/t/p/w500/r16TnsV7xgI6M2hbySzxWbT9zxe.jpg","count":687,"value":"7.700","actors":["科特·柯本","考特尼·洛夫","Krist Novoselic","戴夫·格羅爾","Frances Bean Cobain"],"directors":["Brett Morgen"]}},{"model":"minip.tmdbmovie","pk":1264,"fields":{"overview":"保罗独自在罗马监狱里受折磨，等待着罗马皇帝尼禄的处决。雄心勃勃的监狱长Mauritius无法看透到底是什么对这位潦倒破碎的男人构成威胁。他曾是Saul of Tarsus，基督教徒中高级又野蛮的杀手，他的信仰给罗马人带来了恐惧。医师Luke冒着极大风险前去探望保罗，安慰、照料他，将保罗的信件转录、偷偷带出去，交与日益增长的信徒们。在尼禄惨无人道的迫害下，这些人们将极力传播基督教福音，改变世界。","tmdb_id":"476968","title":"使徒保罗","original_title":"Paul, Apostle of Christ","publish_date":"2018-03-23","budget":5000000,"runtime":108,"revenue":22500000,"backdrop_path":"https://image.tmdb.org/t/p/w500/uk9YSV4GT4iZ9FS5tOJCOmub8GQ.jpg","poster_path":"https://image.tmdb.org/t/p/w500/2NUXG94dGMKYgJL1BkJGKynMb3l.jpg","count":353,"value":"7.591","actors":["詹姆斯·卡维泽","詹姆斯·福克纳","奥利维尔·马丁内斯","琼妮·威利","约翰·林奇"],"directors":["Andrew Hyatt"]}},{"model":"minip.tmdbmovie","pk":1714,"fields":{"overview":"爱德华·刘易斯是个身家百万的企业巨头，也是个潇洒迷人的青年男子。但是麻烦的是他总是搞不好和女人的关系，最近，他与女友的关系又破裂了。 爱德华到洛杉矶出差。一天夜里，他向他的朋友——律师菲利普借了一辆高级轿车想出去解闷，却不知不觉将车开到了红灯区。在一条林荫道上，迷失方向的爱德华只好向一位年轻漂亮的妓女维维安问路。维维安的美丽活泼吸引了爱德华。在付出一笔小费之后，维维安答应送他回旅馆。当回到套间里时，爱德华已经不想让维维安离开了。于是他又继续“雇”了她一夜。爱德华发现自己喜欢上了维维安，但又碍于面子不能出口。菲利普出了个主意，花3000元雇她一周作为出席交际活动的女伴。维维安接受了爱德华的要求。当她装扮停当赶到时，看上去俨然是一位贵妇人。在用餐时，维维安对年轻的戴维发生了兴趣；而在马球比赛时，两人又热切交谈。这引起了爱德华的醋意大发。回到旅馆后，维维安发现自己已爱上了爱德华，两人谁也不能离开对方了。一周很快过去，爱德华想要出钱把她安置在纽约一所公寓里，维维安干脆地拒绝了。维维安离开了爱德华回到自己的公寓，她决定去上学，开始重新做人。正当她准备出门时，爱德华的汽车已停到了门外……","tmdb_id":"114","title":"风月俏佳人","original_title":"Pretty Woman","publish_date":"1990-03-23","budget":14000000,"runtime":120,"revenue":463406268,"backdrop_path":"https://image.tmdb.org/t/p/w500/3tuWpnCTe14zZZPt6sI1W9ByOXx.jpg","poster_path":"https://image.tmdb.org/t/p/w500/tLF2oZ5UkOcmXSkGryNBwGiDjpS.jpg","count":8197,"value":"7.467","actors":["理查·基尔","朱莉娅·罗伯茨","杰森·亚历山大","拉尔夫·贝拉米","阿莱克斯·海德-怀特"],"directors":["加里·马歇尔"]}}]

  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {

  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady() {
    this.setLunar()

  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow() {
    let today_date = wx.getStorageSync('today_date')
    today_date = new Date(today_date)
    let day = new Date()
    // let day = 29
    if (today_date.getDate() != day.getDate()) {
      wx.setStorageSync('today_date', new Date())
      this.regetMovieData()
      this.setLunar()
    }
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide() {

  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload() {

  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh() {

  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom() {

  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage() {
    const promise = new Promise(resolve => {
      setTimeout(() => {
        resolve({
          title: '快来看看历史上今天的电影'
        })
      }, 2000)
    })
    return {
      title: '快来看看历史上今天的电影',
      path: '/calendar/calendar',
      promise
    }
  },
setLunar: function () {
  let lunar_obj = wx.getStorageSync('lunar_obj')
  let solar_obj = wx.getStorageSync('solar_obj')
  let ganzhi = lunar_obj.ganzhi
  let year = solar_obj.year
  let lunar_month = lunar_obj.month
  let month = solar_obj.month
  let lunar_day = lunar_obj.day
  let day = solar_obj.day
  let lunar_date = lunar_month + lunar_day
  let good = lunar_obj.good.slice(0, 2)
  let bad = lunar_obj.bad.slice(0, 2)
  let weekday = solar_obj.weekday
  this.setData({
    ganzhi,
    lunar_date,
    good,
    bad,
    year,
    month,
    day,
    weekday,
  })

},
})